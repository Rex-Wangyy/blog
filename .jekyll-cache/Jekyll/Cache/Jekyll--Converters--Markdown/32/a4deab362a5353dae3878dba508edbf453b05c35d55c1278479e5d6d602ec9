I"áD<h2 id="æ•°æ®å·ä¸ç½‘ç»œ">æ•°æ®å·ä¸ç½‘ç»œ</h2>

<p>â€‹		<strong>Data Volume</strong>ï¼Œæ•°æ®å·æ˜¯ä»å¤–ç•ŒæŒ‚è½½åœ¨å®¹å™¨å†…æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œå¯ä»¥è„±ç¦»å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸè€Œç‹¬ç«‹å­˜åœ¨ã€‚å®¹å™¨é€€å‡ºæˆ–è€…åˆ é™¤åï¼Œæ•°æ®å·ä¸æ”¶ä»»ä½•å½±å“ã€‚æ•°æ®å·æ•°æ®ä¸ç»§æ‰¿ä¸é•œåƒï¼Œå†™æ—¶å¤åˆ¶æœºåˆ¶ä¸ä¼šä½œç”¨äºæ•°æ®å·ï¼Œä¸ä¼šè¢«docker commitæäº¤ã€‚</p>

<p>â€‹		é€šè¿‡åˆ›å»ºå®¹å™¨åˆ›å»ºçš„æ•°æ®å·ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¯¹äºé€šè¿‡ -vå‚æ•°æŒ‡å®šçš„å¹¶å·²ç»å­˜åœ¨çš„æ•°æ®å·ä¹Ÿä¼šæ‰¾åˆ°å¹¶æŒ‚è½½ã€‚å¯ä»¥å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªæ•°æ®å·ï¼Œå¯ä»¥å®ç°å®¹å™¨ä¹‹é—´çš„æ–‡ä»¶æ•°æ®å…±äº«ã€‚</p>

<p>â€‹		<strong>æ•°æ®å·å®¹å™¨</strong> ï¼Œä¸“é—¨å­˜æ”¾æ•°æ®å·çš„å®¹å™¨ï¼Œä¸åœ¨æŠŠå®¿ä¸»æœºçš„ç›®å½•å½“åšæ•°æ®å·è¿›è¡ŒæŒ‚è½½ï¼Œä»¥å…ç ´å…³dockerçš„ç»Ÿä¸€æ€§ï¼Œä»æ•°æ®å·å®¹å™¨è¿›è¡Œæ•°æ®å·çš„æŒ‚è½½ã€‚åªæ˜¯å…¶ä»–å®¹å™¨ä¸æ•°æ®å·è¿æ¥çš„æ¡¥æ¢ï¼Œå¹¶ä¸éœ€è¦ä¿è¯æ•°æ®å·å®¹å™¨å¿…é¡»åœ¨è¿è¡ŒçŠ¶æ€ã€‚å…¶ä»–å®¹å™¨åªæ˜¯åˆ©ç”¨æ•°æ®å·å®¹å™¨ç»™å‡ºçš„æ•°æ®å·ä¿¡æ¯åœ¨dockerä¸­æ‰¾åˆ°å¯¹åº”çš„æ•°æ®å·ã€‚æœ€å¥½ä½¿ç”¨å¤šä¸ªæ•°æ®å·å®¹å™¨å­˜æ”¾ç®¡ç†æ•°æ®å·ã€‚</p>

<h3 id="æ•°æ®å·">æ•°æ®å·</h3>

<h4 id="åˆ›å»ºæ•°æ®å·">åˆ›å»ºæ•°æ®å·</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åˆ›å»ºæ•°æ®å· -v æŒ‚è½½æ•°æ®å·ï¼Œå¯æŒ‚è½½å¤šä¸ª
# æ‰€æœ‰å¯¹ /html ä¸­çš„æ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯å¯¹æ•°æ®å·çš„æ“ä½œ
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">v</span> <span class="o">&lt;</span><span class="n">path1</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">v</span> <span class="o">&lt;</span><span class="n">path2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>
<span class="c1"># å•ç‹¬åˆ›å»ºæ•°æ®å·
</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">volume</span><span class="o">&gt;</span>

<span class="c1"># eg
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">myweb</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">html</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">nginx</span> <span class="n">nginx</span>
<span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">myvolume</span>
</code></pre></div></div>

<p><img src="https://rex-wangyy.github.io/Imgs/docker/åˆ›å»ºæŒ‚è½½æ•°æ®å·.png" /></p>

<h4 id="æŸ¥çœ‹æ•°æ®å·ä¿¡æ¯">æŸ¥çœ‹æ•°æ®å·ä¿¡æ¯</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># command
</span><span class="n">docker</span> <span class="n">inspect</span> <span class="o">&lt;</span><span class="n">volume</span><span class="o">&gt;</span>

<span class="c1"># eg
</span><span class="n">docker</span> <span class="n">inspect</span> <span class="n">myvolume</span>
</code></pre></div></div>

<p><img src="https://rex-wangyy.github.io/Imgs/docker/æ•°æ®å·è¯¦ç»†ä¿¡æ¯.png" /></p>

<h4 id="æŒ‚è½½æ•°æ®å·">æŒ‚è½½æ•°æ®å·</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æŒ‚è½½å·²ç»å­˜åœ¨çš„æ•°æ®å· -v &lt;æ•°æ®å·å&gt;:&lt;æŒ‚è½½è·¯å¾„&gt;
# å¦‚æœåŸè·¯å¾„å·²å­˜åœ¨ï¼Œä¼šéšè—åŸæœ‰ç›®å½•ï¼Œå¹¶ç”¨æ•°æ®å·æ›¿æ¢
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">v</span> <span class="o">&lt;</span><span class="n">volume</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>
<span class="c1"># å°†å®¿ä¸»æœºä¸­å·²å­˜åœ¨çš„ç›®å½•ä½œä¸ºæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨ä¸­ åªè¯» :ro
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">v</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">path</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">container</span> <span class="n">path</span><span class="o">&gt;</span><span class="p">:</span><span class="n">ro</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>  

<span class="c1"># eg
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">mycontainer2</span> <span class="o">-</span><span class="n">v</span> <span class="n">myvolume</span><span class="p">:</span><span class="o">/</span><span class="n">html</span> <span class="n">nginx</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">mycontainer3</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">yingyu</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">docker_dir</span><span class="o">/</span><span class="n">volume</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mynginx</span><span class="p">:</span><span class="n">ro</span> <span class="n">nginx</span>
</code></pre></div></div>

<p><img src="https://rex-wangyy.github.io/Imgs/docker/æŒ‚è½½æ•°æ®å·.png" /></p>

<h4 id="æŸ¥çœ‹æ•°æ®å·åˆ—è¡¨">æŸ¥çœ‹æ•°æ®å·åˆ—è¡¨</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span> <span class="n">volume</span> <span class="nb">list</span>
</code></pre></div></div>

<p><img src="https://rex-wangyy.github.io/Imgs/docker/æŸ¥çœ‹æ•°æ®å·åˆ—è¡¨.png" /></p>

<h4 id="åˆ é™¤æ•°æ®å·">åˆ é™¤æ•°æ®å·</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å•ç‹¬åˆ é™¤/éšå®¹å™¨åˆ é™¤
</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">v</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span>
<span class="n">docker</span> <span class="n">volume</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">volume</span><span class="o">&gt;</span>
<span class="c1"># åˆ é™¤æ— ä¸»çš„æ•°æ®å·
</span><span class="n">docker</span> <span class="n">volume</span> <span class="n">prune</span>

<span class="c1"># eg
</span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">v</span> <span class="n">mycontainer2</span>
<span class="n">docker</span> <span class="n">volume</span> <span class="n">rm</span> <span class="n">myvolume</span>
</code></pre></div></div>

<p><img src="https://rex-wangyy.github.io/Imgs/docker/åˆ é™¤æ•°æ®å·.png" /></p>

<h3 id="æ•°æ®å·å®¹å™¨">æ•°æ®å·å®¹å™¨</h3>

<h4 id="ä½¿ç”¨æ•°æ®å·å®¹å™¨">ä½¿ç”¨æ•°æ®å·å®¹å™¨</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åˆ›å»ºæ•°æ®å·å®¹å™¨
</span><span class="n">docker</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">volumeDataContainer</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">html</span> <span class="n">debian</span><span class="p">:</span><span class="n">jessie</span>
<span class="c1"># æŒ‚è½½æ•°æ®å·å®¹å™¨
# --volumes-from å¯ä»¥æŒ‚è½½æŒ‡å®šæ•°æ®å·å®¹å™¨ä¸­æ‰€æœ‰çš„æ•°æ®å·ï¼ŒæŒ‚è½½è·¯å¾„ä¼šä½¿ç”¨åˆ›å»ºæ•°æ®å·å®¹å™¨æ—¶çš„æŒ‡å®šçš„æŒ‚è½½ç›®å½•(è·¯å¾„)
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">mycontainer</span> <span class="o">--</span><span class="n">volumes</span><span class="o">-</span><span class="k">from</span> <span class="n">volumeDataContainer</span> <span class="n">nginx</span>
<span class="c1"># å¯¼å‡ºæ•°æ®å·
# cf create file  P ç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ç›¸å¯¹è·¯å¾„
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">volumes</span><span class="o">-</span><span class="k">from</span> <span class="n">volumeDataContainer</span> <span class="o">-</span><span class="n">v</span> <span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">):</span><span class="o">/</span><span class="n">backup</span> <span class="o">--</span><span class="n">name</span> <span class="n">exporter</span> <span class="o">--</span><span class="n">rm</span> <span class="n">debian</span><span class="p">:</span><span class="n">jessie</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="n">tar</span> <span class="n">cfP</span> <span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">backup</span><span class="p">.</span><span class="n">tar</span> <span class="o">/</span><span class="n">data</span>
<span class="c1"># ç›´æ¥å¯¼å‡ºæ— äº¤äº’
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">volumes</span><span class="o">-</span><span class="k">from</span> <span class="n">volumeDataContainer</span> <span class="o">-</span><span class="n">v</span> <span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">):</span><span class="o">/</span><span class="n">backup</span> <span class="o">--</span><span class="n">rm</span> <span class="n">ubuntu</span> <span class="n">tar</span> <span class="n">cfP</span> <span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">backup2</span><span class="p">.</span><span class="n">tar</span> <span class="o">/</span><span class="n">html</span>
<span class="c1"># æ¢å¤æ•°æ®å·ï¼Œ x extract ä»å¤‡ä»½æ–‡ä»¶ä¸­è¿˜åŸæ–‡ä»¶
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">volumes</span><span class="o">-</span><span class="k">from</span> <span class="n">volumeDataContainer</span> <span class="o">-</span><span class="n">v</span> <span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">):</span><span class="o">/</span><span class="n">backup</span> <span class="o">--</span><span class="n">rm</span> <span class="n">ubuntu</span> <span class="n">tar</span> <span class="n">xfP</span> <span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">backup</span><span class="p">.</span><span class="n">tar</span> <span class="o">/</span><span class="n">html</span>
</code></pre></div></div>

<h3 id="ç½‘ç»œ">ç½‘ç»œ</h3>

<p>dockeré€šè¿‡Network Namespaceçš„æ–¹å¼ä¸ºæ¯ä¸ªå®¹å™¨å»ºç«‹äº†ç‹¬ç«‹çš„ç½‘ç»œã€‚dockerå¯åŠ¨æ˜¯ä¼šåœ¨å®¿ä¸»æœºä¸Šæ¶è®¾ä¸€ä¸ªåä¸ºdocker0çš„è™šæ‹Ÿç½‘ç»œï¼Œç”¨æ¥è¿æ¥å®¿ä¸»æœºä¸å®¹å™¨ã€‚</p>

<p>å®¹å™¨å¯åŠ¨æ—¶ä¼šæŠŠç‹¬ç«‹ç½‘ç»œé€šè¿‡ Veth Pair è¿æ¥åˆ°docker0ã€‚å½“è¿æ¥åˆ°docker0ä¸Šæ—¶ï¼Œå°±ä¸å…¶ä»–è¿æ¥åˆ°æ­¤çš„å®¹å™¨å±äºåŒä¸€ä¸ªå­ç½‘ä¸­ã€‚å®¹å™¨é—´é€šè¿‡docker0å­ç½‘æ¥äº’ç›¸è®¿é—®ã€‚</p>

<h4 id="ç»‘å®šç«¯å£é™åˆ¶ip">ç»‘å®šç«¯å£ï¼Œé™åˆ¶ip</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ç«¯å£ç»‘å®š -P éšæœºå¯»æ‰¾å¯ç”¨ç«¯å£ç»‘å®š -p æŒ‡å®šç«¯å£
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">&gt;</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">port1</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">container</span> <span class="n">port1</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">port2</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">container</span> <span class="n">port2</span><span class="o">&gt;</span> <span class="p">...</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">&gt;</span>
<span class="c1"># ipé™åˆ¶ åªæ¥å—æ­¤ipçš„è¯·æ±‚
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">local</span> <span class="n">port</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">container</span> <span class="n">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">&gt;</span>

<span class="c1"># eg
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">p</span> <span class="mi">443</span><span class="p">:</span><span class="mi">443</span> <span class="n">nginx</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">443</span><span class="p">:</span><span class="mi">443</span> <span class="n">nginx</span>
</code></pre></div></div>

<h4 id="å®¹å™¨é—´é€šä¿¡">å®¹å™¨é—´é€šä¿¡</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å®¹å™¨é—´é€šä¿¡ execè¿›å…¥å®¹å™¨å¯ç”¨ env æŸ¥çœ‹ç›¸å…³ä¿¡æ¯
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">mysql</span> <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="n">root</span> <span class="n">mysql</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">p</span> <span class="mi">443</span><span class="p">:</span><span class="mi">443</span> <span class="o">--</span><span class="n">name</span> <span class="n">mynginx</span> <span class="o">--</span><span class="n">link</span> <span class="n">mysql</span> <span class="n">nginx</span>

<span class="c1"># è¿æ¥åˆ«å å®¹å™¨ä¸­ env å‘½ä»¤æŸ¥çœ‹ä¿¡æ¯å¯¹åº”åå­—
</span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">p</span> <span class="mi">443</span><span class="p">:</span><span class="mi">443</span> <span class="o">--</span><span class="n">name</span> <span class="n">mynginx</span> <span class="o">--</span><span class="n">link</span> <span class="n">mysql</span><span class="p">:</span><span class="n">db</span> <span class="n">nginx</span>
</code></pre></div></div>

:ET